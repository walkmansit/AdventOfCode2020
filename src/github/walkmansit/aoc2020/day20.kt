package github.walkmansit.aoc2020

import java.lang.StringBuilder
import kotlin.math.sqrt

object Day20 {

    private val input = """
        Tile 2789:
        .#..#...##
        ##...#....
        #.#.##..#.
        .#.##.##.#
        ....#....#
        #.#......#
        .....#....
        #.........
        ...#.....#
        ###.####.#

        Tile 3041:
        ###.#.....
        #.........
        .......#.#
        ..#.#.....
        .#.#...#.#
        #.#.#..#.#
        .#.....#.#
        ...#.....#
        ......#.#.
        ####.#.##.

        Tile 2663:
        #..##..#..
        ..........
        #...#.....
        #.....#...
        #..#.#...#
        ..#......#
        ....#..#..
        .........#
        #.........
        .####..#..

        Tile 2477:
        #....#..##
        .#........
        #.........
        .###.....#
        ..##....##
        ........#.
        .....#..#.
        .....#....
        ......#...
        #######.##

        Tile 3673:
        ........#.
        ###.......
        #..#.#..#.
        #.#..#....
        #.....#..#
        #........#
        ..#...#.#.
        ...#....#.
        #..#...#.#
        ##.####..#

        Tile 1031:
        .####...##
        ..#......#
        #........#
        #..#......
        ....##.#..
        ##........
        ......##..
        ##.....#.#
        ....#.....
        .##.###.#.

        Tile 3119:
        ....##.#.#
        #........#
        #.....#...
        #..#..##.#
        #..#...###
        #.#.###...
        ..#......#
        ...#.#.#.#
        ..#..#...#
        ##...#..##

        Tile 3347:
        #.##..#.#.
        .#.#.#...#
        ##..#..#..
        .....##..#
        .....#...#
        ....#.....
        .......#..
        ..........
        ..#...#...
        ##..##.#.#

        Tile 1747:
        #.##...#.#
        ##..#....#
        ......#.#.
        #..#....#.
        #..##...##
        #.##...#..
        ..#.#..#.#
        ..........
        ....##.##.
        #...#....#

        Tile 1693:
        ..####...#
        #.....#.##
        .....#....
        #....#....
        ...#.....#
        ..........
        #.#....#..
        #..#.....#
        #....#.#.#
        ...####.#.

        Tile 1093:
        ###...#.#.
        #.....#.#.
        .......##.
        ..#.#...#.
        #..#...###
        #..###.#.#
        ....#...#.
        .......#.#
        ...##.....
        #.####..#.

        Tile 1223:
        .#...#..##
        ........#.
        #..#......
        #.##.....#
        ###.##...#
        ##...#..##
        #.#.#.....
        #.##......
        #....#....
        ###.######

        Tile 1307:
        .#..#....#
        ###..#...#
        ..#.......
        ........##
        .#......#.
        ###.##....
        ##.......#
        ##....#...
        ..##.#.#..
        ##..#..#.#

        Tile 1123:
        ###...#...
        #....#...#
        #......#..
        #.#..#...#
        .#.#..#...
        #........#
        .#...#.#..
        ........##
        ...#......
        ######.##.

        Tile 1019:
        ..#..#.#..
        .#..##....
        #####.#..#
        #...#....#
        #....#...#
        #.........
        #.....#...
        .....#..#.
        ....#....#
        #...#.#.#.

        Tile 2083:
        ..####....
        ....#.....
        ...##...#.
        .#.....###
        #..##.##.#
        ..........
        #.......#.
        #....#.###
        .##....##.
        #######..#

        Tile 1361:
        ..##.##...
        ##..#....#
        #.........
        ##....#...
        ...#.....#
        #....#..#.
        .........#
        #....#....
        #.....#...
        ..########

        Tile 2927:
        #..#...#.#
        #..#..#...
        ..##.#...#
        #...###...
        ##...#.#.#
        ......#..#
        .........#
        ..##....##
        ..#......#
        #..#######

        Tile 2111:
        .###.#.##.
        #.........
        ...#...#.#
        .........#
        .....#..#.
        ##........
        ..##.....#
        ##........
        ##......##
        ##.##.#..#

        Tile 1481:
        ....#.....
        #.........
        .........#
        #.........
        #.....##.#
        ...##....#
        #.#...#...
        #..#.#...#
        #...#.#...
        #....#.#.#

        Tile 3931:
        #..#....##
        .....#....
        ......#...
        ...#.##..#
        ...###.#.#
        #..#.#....
        .##.......
        #....#....
        #...#.#..#
        #.##...###

        Tile 3697:
        #.#.######
        ##...#....
        ##.....#.#
        #........#
        ...#......
        #.#.......
        ...##.....
        .........#
        .#...##...
        ...#..###.

        Tile 3089:
        #.#..#..##
        .........#
        #.........
        .......#..
        #.......#.
        .......##.
        #....###..
        ..........
        ....#.....
        ##...#.#..

        Tile 1823:
        ...##...#.
        ...#......
        ..##....##
        ...#......
        .#.#......
        ###...#.##
        #.....#...
        #......##.
        ..#.#.#.##
        ##.....###

        Tile 2843:
        #####.#...
        ........#.
        #..#...#.#
        #.......##
        ##..##.#..
        #.........
        ........#.
        .......#..
        .#.##....#
        ..#.#..#.#

        Tile 2377:
        .#.##..###
        ...#..##..
        .#...#..##
        ...#...#..
        ....#...##
        ##....#..#
        ..#.....##
        #..#......
        ..#..#...#
        ..##.#...#

        Tile 2069:
        #########.
        #.......#.
        #......#.#
        #........#
        #....#.#..
        #.........
        #........#
        .##......#
        #..##..#.#
        .####.....

        Tile 2551:
        ..##..####
        .##....##.
        .#.......#
        ##.....##.
        ....#####.
        ...#.....#
        ...#.#.###
        ...##....#
        ....#....#
        ..#..#..#.

        Tile 1193:
        ###...####
        ##..###.#.
        .#.#.#...#
        ..##...##.
        #...#....#
        .......#.#
        #.......#.
        ..#.#.....
        #..##....#
        ###.#..#.#

        Tile 1451:
        #.#.###.#.
        #...#....#
        ....#.....
        .........#
        ....#..#..
        ..........
        .#........
        ........##
        .........#
        #...##..#.

        Tile 1567:
        #..##....#
        ..........
        ...##..#.#
        #..#####..
        #.......##
        ##..##.#..
        ##.......#
        #.....##..
        ....###..#
        .#.#.####.

        Tile 2707:
        #####.#.#.
        ......#..#
        ##........
        #.....#..#
        ...#.....#
        ...#......
        .##.....#.
        #......#..
        #..####..#
        ..#..#..#.

        Tile 3863:
        .#.###...#
        ...#......
        .#.#..#..#
        #..#..##..
        ..#.#..##.
        ......#.##
        ##..#.....
        #......#.#
        #.........
        .....##.##

        Tile 3331:
        #.####..#.
        #...#..###
        #..#...##.
        ...#...#.#
        #...#...##
        #.#......#
        .........#
        ....#...##
        #..#...#..
        #.#...####

        Tile 2423:
        #..##.#.##
        #....#....
        ..........
        #..#.....#
        ..........
        #...#.....
        ......#..#
        ...#..#...
        ..#.#....#
        ...###..##

        Tile 2207:
        ...#...#..
        #....#....
        #..#.....#
        ........#.
        #........#
        .......#..
        ##....#..#
        ........#.
        #.....#..#
        ....#.....

        Tile 1913:
        ..#.#..#..
        #.........
        ..........
        .........#
        #.......#.
        #..#...#..
        ..........
        ...####...
        ...#.#..##
        #######.#.

        Tile 2963:
        #..##...##
        ..........
        ...#.#....
        #........#
        #.#....#..
        ..#..#...#
        #....#...#
        ......#..#
        #.......#.
        #.#.#.#..#

        Tile 3733:
        ##.##.#...
        ...#.#....
        ......#...
        #.........
        #.........
        #.........
        ..#...##.#
        .....#....
        #....#....
        ##.#...##.

        Tile 2239:
        ...###.#.#
        ##....#...
        ##.#......
        #........#
        #..#.....#
        ..........
        ....#.#.##
        ##........
        ........#.
        .#.#####.#

        Tile 1063:
        ..#####.##
        #....#...#
        .........#
        #..#..#...
        ..#..#...#
        #......#..
        ..##.#..##
        .........#
        #.#.#..#.#
        ...#..####

        Tile 2749:
        ..#.##.#.#
        ...#.....#
        .......#.#
        #.#.......
        .........#
        ..........
        .........#
        ###.#..#..
        #.##...##.
        ###.#....#

        Tile 1187:
        ##.#.....#
        #....#...#
        #.#..#....
        #.###.....
        .......#..
        ...#......
        ##........
        ..........
        ..........
        .#########

        Tile 1613:
        ####......
        #.#.#...#.
        ##........
        #......#..
        ..#.##...#
        .###.#....
        ...#.....#
        ..........
        #........#
        .#........

        Tile 2521:
        ##...#..#.
        .#....#..#
        ..##...#..
        ..#.#.....
        #....#....
        ....##....
        #.#.#.....
        .....#...#
        ........#.
        .#..##.#..

        Tile 3671:
        ###..#....
        .#.....###
        #...#..#.#
        ......##..
        ##..#.##.#
        ...#.##..#
        .##...#.##
        .#.#.#.#.#
        ..........
        .#...##...

        Tile 1459:
        ...##..###
        ...##..#.#
        ..##..#.#.
        #.##..#..#
        ....#....#
        #.##.##..#
        ##......##
        ....##.###
        ...#..#..#
        ###.#..#.#

        Tile 2999:
        ###..##...
        .........#
        #.....#...
        .#.#.....#
        #.#.#..###
        .#.....#..
        #..#......
        ..#.#.....
        #..#.#.#.#
        .####...#.

        Tile 1973:
        #.####.##.
        #...#....#
        ..##..#...
        .........#
        ####..#...
        #.##....#.
        #.#.#..###
        ....##...#
        #..#.....#
        .###.#..##

        Tile 1999:
        ###.##...#
        .........#
        .......#..
        ........#.
        #.#.....##
        ....#.....
        ...#....##
        #...##....
        ..........
        ..##..####

        Tile 2371:
        ###.##...#
        ...#......
        ..........
        ...##....#
        ........#.
        #.#..##...
        ......#...
        ##......##
        #........#
        .##.###.##

        Tile 3793:
        #..##..#..
        #.......#.
        ...#.#.#..
        .#......##
        .......###
        .#........
        .....#....
        ....#....#
        ....#..###
        .#.###..#.

        Tile 2791:
        #..#####.#
        #...##....
        #........#
        #.....#...
        ........##
        ...#.....#
        ..##.#...#
        ........#.
        #........#
        .#..#.####

        Tile 2903:
        ##....##.#
        .#.......#
        .#..#.....
        #...#.###.
        #..#.#.##.
        #.........
        ......#...
        .#.....#.#
        .....#...#
        .#......##

        Tile 1619:
        .....###..
        ..##...#..
        #.#.#....#
        ##...##...
        #.....##.#
        .#...####.
        .#.......#
        #......#.#
        #.#..##...
        ..#.##...#

        Tile 2267:
        ##....###.
        #...###.##
        ..##.#...#
        ##.....#..
        #.....#.#.
        .#.#...###
        .##....#.#
        #.#......#
        #.#..#....
        ..###..#..

        Tile 1429:
        #.#..#.#..
        .......#.#
        #.......#.
        ....#..###
        #.#......#
        #...#.##.#
        #.....###.
        #.....#.##
        .....#....
        ###....##.

        Tile 3593:
        #..##...#.
        ..#......#
        #......###
        ....#.....
        #.........
        ##.......#
        ##........
        ..#.#....#
        ...#.#....
        ###.######

        Tile 2801:
        .##.#.....
        .........#
        #........#
        #...#.#..#
        .##...#..#
        ..#.#.....
        #.........
        #.##..#...
        .....#...#
        #...##.#.#

        Tile 1997:
        .###......
        #......#..
        #.....##..
        ..#..##...
        ##.....#.#
        .##.....##
        ..#.....##
        .......#.#
        ......##..
        ..#..##.##

        Tile 1499:
        ....#.##.#
        #.#.....#.
        ...#.#...#
        .........#
        #.........
        ..........
        ....#.....
        #........#
        ..#...#...
        #..##.###.

        Tile 3191:
        .#..###.##
        .....#..##
        ..........
        .#..#..##.
        #....###.#
        .....#...#
        ..#.#.....
        .....#.#..
        #...#.#..#
        ...###....

        Tile 3121:
        .#.#.#..#.
        ...#..##..
        #........#
        .#...#..##
        #.#.......
        .....#....
        ..#.#....#
        #.....#..#
        #..###...#
        .#####....

        Tile 3023:
        .....##..#
        ......#.#.
        ....#.####
        #.##.....#
        ..........
        #.........
        ......#...
        #......#..
        ...#....#.
        ....#.##..

        Tile 2531:
        ..#..##...
        ..#..#...#
        .....#....
        .#..#..#.#
        #..#..#.#.
        ........##
        .......#.#
        ###.....##
        #..##.#...
        ##...#####

        Tile 3001:
        #####...##
        #.#..#.###
        ...#.....#
        #....#....
        ##.....#..
        .##.....#.
        #.#..#....
        ....#...#.
        #.........
        ..#.#.##.#

        Tile 1399:
        #.##.###.#
        ...##.....
        ...#.....#
        #.#.#....#
        .#.#....#.
        ##..#....#
        ..........
        ...#.....#
        .##.....#.
        ..###....#

        Tile 2251:
        #..#..#...
        .....#..##
        ..##.....#
        #..##....#
        ##.##.###.
        ...#....#.
        ..#..#....
        ...#...#..
        ..........
        ...#.....#

        Tile 2659:
        .###.##..#
        .........#
        ..#.....#.
        ...###...#
        .#...#...#
        #..##....#
        #.......#.
        ......#..#
        #...#..#.#
        ##.##.####

        Tile 3067:
        #..###.###
        #.##......
        ....#.....
        .........#
        ...#....##
        ......#...
        .......#..
        #.#.#....#
        #..#...#.#
        ......##.#

        Tile 1163:
        ..#.#....#
        #.........
        .....#...#
        .#.......#
        #...#..###
        #.......##
        #..#..###.
        #...#....#
        .........#
        .#.#.#....

        Tile 3433:
        #.##...###
        #.........
        #....#..##
        #..#..##..
        ........#.
        ###...#.#.
        .#..##.#..
        ..##.....#
        ..#..#....
        ####...##.

        Tile 3637:
        ###..###.#
        ..........
        .......#..
        .....#....
        #.....#...
        ......#...
        .#........
        .#..#.....
        #..#.#.#.#
        ######..#.

        Tile 3253:
        #..##.#...
        .......###
        .#........
        #........#
        ..........
        ...#....##
        ##.......#
        ##.......#
        #.#......#
        ########.#

        Tile 3271:
        #.##.#...#
        #..#..#...
        ......#.##
        #.....#.#.
        .....#..##
        #..#.....#
        ..........
        #...#.##..
        .......#..
        #..#.##..#

        Tile 2657:
        .#..#..###
        #...#.....
        .....#....
        ###..##...
        #...#..#..
        #..#.....#
        .#........
        ....#..#..
        ....####.#
        .#.#.#...#

        Tile 1087:
        .#.#..####
        ..#...#..#
        ...###.#.#
        .##.#....#
        ...#.....#
        ...#.#....
        ##..#.....
        ##.###..#.
        #.####.#.#
        ##.....#..

        Tile 1721:
        .#.#...###
        .....#...#
        ..#..##..#
        #..#..#.#.
        #.#......#
        .#....#...
        ..#..#.#.#
        #..#..###.
        #........#
        .....#.###

        Tile 3557:
        #...##.#..
        ..###...#.
        ..#.##....
        ##.#..#.##
        #.......#.
        .###.##..#
        ##.#......
        #..#...###
        ..###....#
        ##.##....#

        Tile 1471:
        ...##.#..#
        ....##...#
        .#...#...#
        ......###.
        ....#.#..#
        ##...#...#
        #...#.#...
        ##....#...
        .........#
        #.#..##..#

        Tile 2237:
        ..#.####.#
        ........##
        #.........
        ....##.#.#
        .##....#..
        ..#...#...
        ##..#.....
        ...#....#.
        .......#.#
        ##...#.#..

        Tile 3779:
        ##..#.##.#
        ..##.....#
        #.........
        ...#...##.
        ..###...##
        .##..#.##.
        #......##.
        .#.......#
        ....#.....
        ###.....#.

        Tile 1129:
        .#..#.#..#
        ....#.....
        ##..#.#...
        #.....#..#
        #.#..#..##
        #....#...#
        .#.#...#..
        ........##
        #.##......
        #.....##.#

        Tile 3929:
        ###..#..##
        #........#
        ..#..#....
        .........#
        #.#.......
        ..........
        #..###....
        #.#..#..#.
        #.........
        ###.......

        Tile 1871:
        ###...####
        #....#...#
        #.........
        #...#.....
        ...#...#..
        #........#
        #......#..
        ....#...##
        .......#.#
        #...######

        Tile 2137:
        #..#..##..
        .....#..#.
        .....#....
        ....###...
        #.#...#...
        .....#.#.#
        ######..##
        #..##.#...
        .......#..
        .#.###....

        Tile 2591:
        ####.####.
        .#......##
        #.....#...
        ..........
        #.#..#.###
        .#...###.#
        #.........
        #....#...#
        #.........
        #.#...#...

        Tile 3049:
        ..#....#.#
        ###.#.....
        #.#.......
        ....#....#
        .....#..#.
        .........#
        #...#..#.#
        #...#.#.##
        .....#....
        ..#...#..#

        Tile 2753:
        ##.#.#...#
        #..#.#.#..
        #........#
        #...##....
        ....#.....
        #.##......
        .......###
        #....#....
        ...#...#.#
        ###..#..##

        Tile 1951:
        .#.##.##.#
        .........#
        ......##..
        .....#.#.#
        ###..#....
        ##..#.#..#
        ......#...
        #.........
        .#.#.##...
        #.#.#..#.#

        Tile 2339:
        .......#.#
        .........#
        #.#.....#.
        #.#.###..#
        #.....#...
        ..........
        ...##.....
        ##......##
        ..#.#....#
        .#...#...#

        Tile 1039:
        .######..#
        .#.......#
        #.........
        #..##.#..#
        #.......#.
        #.........
        ...#......
        #..#..#...
        ...#.....#
        .#..###.#.

        Tile 1249:
        #.####.###
        #.......#.
        #...#...#.
        ......#.#.
        #.#.#....#
        ..#.#....#
        .....#.#.#
        #....#....
        #.##.#..#.
        #.#.#.##.#

        Tile 2579:
        #.##.###.#
        #.#.#....#
        #.........
        ##........
        #........#
        #.........
        .##.......
        ..#.......
        #.....#..#
        ##.#..##..

        Tile 3499:
        #.##.#..##
        #.....#.##
        ....#...##
        .....#...#
        ......#...
        .......#.#
        .#....#...
        ......#...
        #.....#...
        ....#.###.

        Tile 2879:
        #.#.#..###
        #........#
        #....#.###
        .#.#.....#
        ....#....#
        ....#...#.
        #..#..##.#
        #.........
        #.....#.#.
        .###.#..##

        Tile 2027:
        #####..###
        ......#.#.
        ........##
        .....#.##.
        #.........
        #..#...#..
        #.#......#
        ####....##
        #...#.##.#
        ##.#.#.#.#

        Tile 1987:
        ##.##.#.##
        #...##...#
        .........#
        #.#.###..#
        .#.##....#
        ....#.....
        .....#...#
        ..........
        .........#
        #..#..##.#

        Tile 3659:
        #.##.#.###
        ..#.....#.
        ......##..
        .........#
        ....#.....
        #..#..#.#.
        #.........
        ##........
        #.........
        #.##.....#

        Tile 2297:
        ##.##..#..
        ...##.....
        #..#.#.#.#
        #....#...#
        ....##....
        #....#...#
        ##......#.
        #....#..##
        ##...##...
        ###..##.#.

        Tile 3739:
        ##...###.#
        #......#..
        #....#....
        .###..#...
        ...##...##
        #..#......
        ....#.##..
        #.....####
        ##.#......
        ##.#...##.

        Tile 3539:
        .#....##.#
        ##....#...
        #......#..
        #.....#.#.
        ##.......#
        ##...#....
        ......#...
        #..#......
        .....#####
        ..###.....

        Tile 3329:
        #.###.####
        ..#.......
        ..........
        ..........
        #.#.......
        ##......#.
        #......##.
        #..#....#.
        .....#...#
        #.###.#.#.

        Tile 1201:
        #..#..####
        #.#...####
        .#...##..#
        ##.#.#..#.
        ..........
        #...#..#..
        ..#..##...
        ...##.#...
        #.....#...
        ##.#.#..#.

        Tile 3559:
        ##....#.##
        #.....#..#
        ##.......#
        #.#.......
        #.........
        ........#.
        ##.......#
        ......##.#
        #.##..#...
        #.....#...

        Tile 3259:
        ...#.#####
        .##.......
        #..#.#...#
        ....#....#
        ..........
        .#.#.....#
        .#....#..#
        .........#
        #.##.#...#
        #..#####.#

        Tile 3407:
        ...##.#..#
        .#..#.....
        #.....#...
        #.#.......
        #.......##
        #....#...#
        ..........
        #....##.#.
        #.##...###
        .#..##.#.#

        Tile 1051:
        ...#...#.#
        ..........
        .........#
        ..#....#.#
        #.#####.#.
        ...#.#...#
        ..##...#.#
        ......#.#.
        #........#
        ##..##.##.

        Tile 3467:
        .#.##.#..#
        #...##....
        #.#..##.#.
        ###...##..
        #.#.#..#.#
        .....#....
        ..........
        ...#..##..
        ###....##.
        .####..#.#

        Tile 1847:
        ....#...#.
        .....##..#
        .#........
        .#.......#
        ........#.
        #......#..
        #..#.##...
        .##...####
        ........##
        .#...###..

        Tile 3623:
        #....####.
        #...#..#..
        .....##...
        #.....#...
        #......##.
        #.##.#...#
        .......###
        .....#.#.#
        ......#..#
        ######....

        Tile 1907:
        ##...#.#.#
        ###.#..#..
        #..#....##
        ..#.....#.
        ........#.
        #.#...#...
        .#.......#
        #......#..
        .....##..#
        ###..#.##.

        Tile 2837:
        #..#....##
        .....#...#
        ....#.#...
        #....#...#
        .....##.#.
        #...#.#.##
        .....#....
        .#...#....
        ..#.#.....
        ###....##.

        Tile 1571:
        ##..####.#
        ..........
        ##..#.....
        #.........
        #....###..
        #.#.#.#..#
        #..###...#
        #.....#..#
        #........#
        .#####....

        Tile 1097:
        #...#.##.#
        #.##.....#
        #....#...#
        ...#...#..
        .###.....#
        ...#...#..
        .#.#..#...
        #.#....#..
        .........#
        .#.##....#

        Tile 2803:
        ###...##..
        #.........
        .......#..
        .....#...#
        ##........
        .......#.#
        ......#...
        ##....####
        #.....#.#.
        .##..####.

        Tile 1319:
        .#.###.#..
        ...#......
        ...##.#...
        .##.##.#.#
        .#.......#
        .....#...#
        #.##......
        #......#..
        ##.......#
        ....###.##

        Tile 1663:
        ##.#..####
        ##...#....
        #....#..##
        .........#
        ####......
        .#...#....
        #........#
        #..##.#...
        #...#....#
        ##.##.#.##

        Tile 1709:
        .#..##..##
        ..#.#.....
        .....#....
        #........#
        .#..#..#.#
        ......####
        #.###...##
        ..#..#..#.
        .#.......#
        ###..##..#

        Tile 1171:
        #..###.###
        #.#......#
        #....#....
        ....##.#..
        #...#....#
        ###......#
        ...#.#####
        ...##....#
        .........#
        .#..####..

        Tile 3469:
        ##....#...
        ..#..##...
        ...#..#...
        #.#....##.
        #.........
        #.........
        .....#...#
        ..#.......
        .....#...#
        .######.##

        Tile 2311:
        .#..###.##
        .#.......#
        #.#.......
        #.........
        ...#...#.#
        .........#
        #..#......
        .....#....
        .##....##.
        ####.#..#.

        Tile 2539:
        #.########
        #......###
        #......#.#
        #...###..#
        #....#..#.
        .#.....###
        .#...#....
        ###.......
        .........#
        .####.####

        Tile 1439:
        .#...#####
        .##.#...#.
        ##...#.#..
        #.#....#.#
        ..#...#.#.
        .........#
        ..#.#....#
        .##...#.##
        ##...#.###
        #.#..#...#

        Tile 2383:
        #####..#.#
        #.#......#
        ..#......#
        ..#...#...
        #.........
        #.........
        ##.#.....#
        #.#..#....
        ..........
        #.##...#.#

        Tile 1559:
        ...#....#.
        #.........
        ...###.#..
        #.##....#.
        ..#....#.#
        ##.#.#..##
        #........#
        ##.....#.#
        #...#....#
        .#.##.#..#

        Tile 3061:
        ###..#####
        .#....#..#
        ......#.##
        #...#....#
        #...#.....
        ...#...#..
        .....##.#.
        #......#..
        ......#..#
        #.##....##

        Tile 1511:
        #.##..#.#.
        #........#
        ##.#..#...
        .#.......#
        .##.#...##
        #..#.#..##
        ..........
        .##...#.##
        #........#
        ..#.#.....

        Tile 3343:
        #....#.##.
        .........#
        #.....#..#
        #.......#.
        #........#
        .........#
        .....#.#..
        .##.......
        #.....#...
        #....###..

        Tile 1277:
        #.#...#.##
        ..##.....#
        ....##....
        ...#....##
        ##.......#
        #....#...#
        #........#
        .........#
        #........#
        .###.#....

        Tile 1291:
        #.#..##...
        ####..#...
        #..#.....#
        .........#
        #..#.....#
        ..........
        ##.##....#
        .#.#...###
        .#.#....#.
        .###....##

        Tile 3109:
        .#..######
        ........##
        ..#.....#.
        ###....#.#
        #...#.....
        .........#
        ...#......
        #........#
        .#...#...#
        .#..##.#.#

        Tile 3821:
        ....###...
        #...##...#
        #.#.##....
        #........#
        .......###
        ...##.#..#
        .....#.#..
        ....##...#
        ...##.....
        #.##..#..#

        Tile 2677:
        ...#....##
        #.#.#....#
        ..........
        .#..###...
        ##..#..#..
        ...##.....
        #.....#.##
        ..#......#
        ##.#.....#
        ####.##..#

        Tile 1933:
        #.#.#...##
        #...#..#..
        #.##...##.
        .......#..
        #.......##
        #.......#.
        .......#..
        #....#..##
        ....#..#..
        #.####.#.#

        Tile 2819:
        ....#...##
        ...#......
        #......#..
        ..........
        ....#.....
        ....#....#
        .......#.#
        ..#......#
        #.....#..#
        .#...##..#

        Tile 1733:
        ..##..##.#
        ......#...
        ...#..#..#
        ..#..#....
        #......#.#
        #........#
        ##.......#
        ....#..##.
        ##.....##.
        #....#..#.

        Tile 1783:
        ##.#....##
        .........#
        ..........
        ......#..#
        #.........
        #..#.#....
        #....#.#.#
        ##.......#
        ..........
        .###..##.#

        Tile 2473:
        .##.##..##
        #......#..
        #........#
        #.#..#.#.#
        #..#..#...
        #........#
        ..##......
        ..#.#....#
        ......#.##
        #.###.#.##

        Tile 2767:
        #......###
        ..........
        .#.#....##
        #..#......
        #......#.#
        ..###...#.
        #.....#.#.
        #...#.....
        ..........
        ###.....#.

        Tile 1091:
        ##..###.##
        #.....#..#
        #.##.....#
        ..........
        #........#
        #..#......
        .........#
        #...#..#..
        .###....#.
        #...#.#..#

        Tile 1609:
        #.#.#....#
        #.....#...
        ..#...#..#
        ##.......#
        #...#.##.#
        #..#......
        ........#.
        .#.......#
        #..#......
        #.#...#.#.

        Tile 3769:
        ...#.##.##
        ##........
        #....#....
        ..........
        .....##.##
        .#........
        #...##...#
        #.........
        ......#...
        #####..#..

        Tile 2011:
        .#.####.##
        ##..#.....
        #..#.#..#.
        #.#.....#.
        #........#
        #.....#..#
        ..#......#
        #......#.#
        ..#.....#.
        .#.#.##.##
    """.trimIndent()

    private val mHeight = 3
    private val mWidth = 20

    private val monsterStr = """
        1                  # 1
        1#    ##    ##    ###1
        1 #  #  #  #  #  #   1
    """.trimIndent()

    private val monster = getMonsterIndices()

    fun getResult() : Long {
        val parts = input.split("\n\n")
        val tiles = parts.map { Tile.fromString(it) }.toMutableList()


        val bordersMap : MutableMap<Int,MutableSet<Int>> = mutableMapOf()

        for (tile in tiles){
            for (bordConfig in tile.getConfigurations()){
                for (border in bordConfig.borders()){
                    if (bordersMap.containsKey(border))
                        bordersMap[border]!!.add(tile.id)
                    else
                        bordersMap[border] = mutableSetOf(tile.id)
                }
            }
        }

        val tilesToBordersMap : MutableMap<Int,MutableSet<Int>> = mutableMapOf()

        for( (border,tiles) in bordersMap){
            if (tiles.size == 2)
                for (tile in tiles){
                    if (!tilesToBordersMap.containsKey(tile))
                        tilesToBordersMap[tile] = mutableSetOf(border)
                    else
                        tilesToBordersMap[tile]!!.add(border)
                }
        }

        val cornersList = tilesToBordersMap.filter { pair -> pair.value.size == 4 }.toList()

        val picture = getPicture(cornersList.first().first,bordersMap,tiles)

        val trimmedPict = trimPictire(picture)

        val config = findConfigWithMonster(Configuration(trimmedPict))

        val sum = markMonstersInConfig(config)

        return tilesToBordersMap.filter { pair -> pair.value.size == 4 }.map { it.key.toLong() }.reduce { a, b -> a*b }
    }

    private fun markMonstersInConfig(config: Configuration) : Int {

        var sum = 0

        val size = config.body.size

        fun drawMonster(y:Int,x:Int,body:Array<Array<Char>>){
            for ((i,j) in monster)
                    body[y+i][x+j] = 'O'
        }

        for (i in 0 until size-mHeight)
            for (j in 0 until size-mWidth){
                if (hasMonsterAtBase(i,j,config.body)){
                    drawMonster(i,j,config.body)
                }

            }

        for (i in 0 until size)
            for (j in 0 until size)
                if (config.body[i][j] == '#') sum++

        return sum
    }


    private fun findConfigWithMonster(config:Configuration) : Configuration {

        for (c in getConfigurations(config))
            if (configContainsMonster(c))
                return c

        return config

    }

    private fun hasMonsterAtBase(y:Int,x:Int,body:Array<Array<Char>>) : Boolean {

        for ((i,j) in monster){
            if (body[y+i][x+j] != '#') return false
        }

        return true
    }


    private fun configContainsMonster(config:Configuration) : Boolean {

        val size = config.body.size

        for (i in 0 until size-mHeight)
            for (j in 0 until size-mWidth)
                if (hasMonsterAtBase(i,j,config.body)) return true


        return false

    }

    private fun getConfigurations(config: Configuration) = sequence {
        var currentConfig = config

        repeat(4) {
            currentConfig = currentConfig.rotate()
            yield(currentConfig)

            val vertState = currentConfig.mirrorVert()
            yield(vertState)

            val horState = currentConfig.mirrorHor()
            yield(horState)

            yield(vertState.mirrorHor())
        }
    }

    fun getResultAdvanced() : Long {
        return 0L
    }

    private fun getPicture(cornerId:Int, bordersMap : MutableMap<Int,MutableSet<Int>>, tiles : List<Tile>) : Array<Array<Tile?>> {

        fun setTopLeftConfigForTile(tile:Tile,set:Set<Int>) : Boolean {

            for (config in tile.getConfigurations()){
                if (bordersMap[config.top]!!.size == 1 && bordersMap[config.left]!!.size == 1){
                    tile.config = config
                    return true
                }
            }

            return false
        }

        fun rotateTileTillMatch(tile:Tile,border:Int, borderIdx:Int) {
            for (config in tile.getConfigurations()){
                if (config.borders()[borderIdx] == border) {
                    tile.config = config
                    return
                }
            }
        }

        val cornerTile = tiles.first { it.id == cornerId }

        val size = sqrt(tiles.size.toDouble()).toInt()

        val picture : Array<Array<Tile?>> = Array(size){Array(size){ null as Tile?} }

        for (i in 0 until size)
            for (j in 0 until size){

                //set first tile
                if (i == 0 && j ==0){

                    val cornerBordersSet = bordersMap.filter { pair -> pair.value.size == 1 && pair.value.contains(cornerId) }.map { it.key }.toSet()
                    val cornerIsFine = setTopLeftConfigForTile(cornerTile,cornerBordersSet)
                    if (cornerIsFine){
                        picture[i][j] = cornerTile
                        continue
                    }
                    else
                        return picture
                }

                //set bottom
                if (j == 0) {
                    val prev = picture[i-1][j]!!
                    val tilesSet = bordersMap[prev.config.bottom]
                    val targetTileIdx = tilesSet!!.first {  it != prev.id }
                    val targetTile = tiles.first { it.id == targetTileIdx }
                    rotateTileTillMatch(targetTile,prev.config.bottom,0)
                    picture[i][j] = targetTile
                }
                //set right
                else {
                    val prev = picture[i][j-1]!!
                    val tilesSet = bordersMap[prev.config.right]
                    val targetTileIdx = tilesSet!!.first {  it != prev.id }
                    val targetTile = tiles.first { it.id == targetTileIdx }
                    rotateTileTillMatch(targetTile,prev.config.right,3)
                    picture[i][j] = targetTile
                }
            }

        val isValid = validatePicture(picture)

        return picture
    }

    private fun getMonsterIndices() : List<Pair<Int,Int>> {

        val result = mutableListOf<Pair<Int,Int>>()

        val lines = monsterStr.split("\n").map { it.substring(1,it.length -1) }

        for ( (i,line) in lines.withIndex()){
            for(j in lines[0]!!.indices) {
                if (line[j] == '#') result.add(i to j)
            }
        }

        return result.toList()

    }

    private fun trimPictire(picture : Array<Array<Tile?>>) : Array<Array<Char>> {

        val result : Array<Array<Char>> = Array(96){ Array((96)){ '-'} }

        fun printTile(tile:Tile, baseI:Int, baseJ:Int) {
            for (i in 1 until 9)
                for (j in 1 until 9){
                    result[baseI+i-1][baseJ+j-1] = tile.config.body[i][j]
                }

        }

        for (i in 0 until 12)
            for (j in 0 until 12){
                val  tile = picture[i][j]!!
                printTile(tile,i*8,j*8)
            }


        return result
    }

    private fun validatePicture(picture : Array<Array<Tile?>>) : Boolean {

        fun validateRightBorder(i: Int, j : Int) : Boolean {

            if (j == 11 ) return true

            val tile = picture[i][j] ?: return false

            val rightTile = picture[i][j+1] ?: return false

            for (row in 0 until 10){
                if (tile.config.body[row][9] != rightTile.config.body[row][0]) return false
            }

            return true
        }

        fun validateBottomBorder(i: Int, j : Int) : Boolean {

            if (i == 11 ) return true

            val tile = picture[i][j] ?: return false

            val bottomTile = picture[i+1][j] ?: return false

            for (col in 0 until 10){
                if (tile.config.body[9][col] != bottomTile.config.body[0][col]) return false
            }

            return true
        }

        for (i in 0 until 12)
            for (j in 0 until 12)
                if (!validateRightBorder(i,j) || !validateBottomBorder(i,j)) return false

        return true

    }

    private fun printBody(body: Array<Array<Char>>) : String {
        val sb = StringBuilder()

        for (i in body.indices)
            for (j in body.indices){
                sb.append(body[i][j])
                if (j == body.size - 1) sb.append("\n")
            }

        return sb.toString()
    }

    data class Configuration(val body : Array<Array<Char>>){
        var top = 0
        var right = 0
        var bottom = 0
        var left = 0

        init {

            val size = body[0].size

            for (i in 0 until size) {

                if (i == 0){
                    for (j in 0 until size){
                        val k = size - j - 1
                        if (body[i][j] =='#') {
                            top = top or (1 shl k)
                        }

                    }
                }

                if (i == size - 1){
                    for (j in 0 until 10){
                        val k = size - j - 1
                        if (body[i][j] =='#') {
                            bottom = bottom or (1 shl k)
                        }

                    }
                }

                if (body[i][size-1] =='#') {
                    val k = size - i - 1
                    right = right or (1 shl k)

                }

                if (body[i][0] =='#') {
                    val k = size - i - 1
                    left = left or (1 shl k)
                }
            }
        }

        fun borders() = arrayOf(top,right,bottom,left)

        fun rotate() : Configuration {
            val newBody: Array<Array<Char>>  = Array(body.size){ Array(body.size){ '-'} }
            for (i in body.indices)
                for (j in body.indices)
                    newBody[i][j] = body[body.size - j - 1][i];

            return Configuration(newBody)
        }

        fun mirrorVert() : Configuration {

            val newBody: Array<Array<Char>>  = Array(body.size){ Array(body.size){ '-'} }
            val half = body.size/2
            for (i in body.indices)
                for (j in 0..half){
                    newBody[i][j] = body[i][body.size - j - 1]
                    newBody[i][body.size - j - 1] = body[i][j]
                }

            return Configuration(newBody)
        }

        fun mirrorHor() : Configuration {val newBody: Array<Array<Char>>  = Array(body.size){ Array(body.size){ '-'} }
            val half = body.size/2
            for (i in 0..half){
                newBody[i] = body[body.size - i - 1]
                newBody[body.size - i - 1] = body[i]

            }

            return Configuration(newBody)
        }
    }

    class Tile private constructor(val id:Int,body : Array<Array<Char>>, var config: Configuration = Configuration(body)
    ) {

        fun getConfigurations() = sequence {
            var currentConfig = config

            repeat(4) {
                currentConfig = currentConfig.rotate()
                yield(currentConfig)

                val vertState = currentConfig.mirrorVert()
                yield(vertState)

                val horState = currentConfig.mirrorHor()
                yield(horState)

                yield(vertState.mirrorHor())
            }
        }

        companion object {

            fun fromString(str:String) : Tile {

                val parts = str.split(":\n")
                val id = parts[0].split(" ")[1].toInt()

                val body : Array<Array<Char>> = Array(10){ Array(10) { ' ' } }

                for ( (i,line) in parts[1].lines().withIndex()){
                    for (j in 0 until 10){
                        body[i][j] = line[j]
                    }
                }

                return  Tile(id,body)
            }

        }
    }


}